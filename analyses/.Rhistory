row.names(BDdataREL) == row.names(design)
#PERMANOVA on rotation effect - no S and W
new.data <-cbind(design,BDdataREL)
adonis = adonis(new.data[,-c(1:15)] ~ rotation+block, method = "bray", data = new.data, perm=1000)
adonis
# Create Distance Matrix
sampleREL.dist <- vegdist(BDdataREL, method="bray")
# Principal Coordinates Analysis
BD_pcoa <- cmdscale(sampleREL.dist, k=3, eig=TRUE, add=FALSE)
# Classical (Metric) Multidimensional Scaling; returns PCoA coordinates
# eig=TRUE returns eigenvalues; k = # of dimensions to calculate
explainvar1 <- round(BD_pcoa$eig[1] / sum(BD_pcoa$eig), 3) * 100
explainvar2 <- round(BD_pcoa$eig[2] / sum(BD_pcoa$eig), 3) * 100
sum.eig <- sum(explainvar1, explainvar2)
# Create Distance Matrix
sampleREL.dist <- vegdist(BDdataREL, method="bray")
# Principal Coordinates Analysis
BD_pcoa <- cmdscale(sampleREL.dist, k=3, eig=TRUE, add=FALSE)
# Classical (Metric) Multidimensional Scaling; returns PCoA coordinates
# eig=TRUE returns eigenvalues; k = # of dimensions to calculate
explainvar1 <- round(BD_pcoa$eig[1] / sum(BD_pcoa$eig), 3) * 100
explainvar2 <- round(BD_pcoa$eig[2] / sum(BD_pcoa$eig), 3) * 100
sum.eig <- sum(explainvar1, explainvar2)
points <- cbind(as.data.frame(BD_pcoa$points), treatments)
L.centroids <- melt(points, id="treatments", measure.vars = c("V1", "V2"))
centroids <- cast(L.centroids, variable ~ treatments, mean)
centroids.se <- cast(L.centroids, variable ~ treatments, se)
centroids.sd <- cast(L.centroids, variable ~ treatments, sd)
cent.dataframe <- t(data.frame(rbind(centroids[1,-1], centroids[2,-1],
centroids.sd[1,-1],centroids.sd[2,-1])))
colnames(cent.dataframe) <- c("V1", "V2", "V1e", "V2e")
cent.treats <- rownames(cent.dataframe)
explainvar1 #Include in PCoA 1 axis label 29.3%
explainvar2 #Include in PCoA 2 axis label 14.0%
df <- as.data.frame(cent.dataframe)
p <- ggplot(df, aes(x=V1, y=V2, colour=cent.treats)) + theme_bw()
p + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(size=5) +
scale_colour_manual(labels = c("mC", "C_1cov", "CS", "CSW", "CSW_1cov", "CSW_2cov", "fallow"),   values = c("#FFFFCC", "#FFFF00", "#FF9933", "#66CC00", "#339900", "#336633", "#00CCFF")) +
geom_point(shape=1, size = 5,colour = "black") +
theme(axis.title=element_text(size=18), axis.text=element_text(size=14), axis.text.x   = element_text(size=14), panel.border = element_rect(colour = "black",size=1.25)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
xlab("PCoA 1 (29.3%)") + ylab("PCoA 2 (14.0%)") +
labs(color = "Crop diversity") +
guides(colour = guide_legend(override.aes = list(pch=21, size = 4, colour="black",
fill=c("#FFFFCC", "#FFFF00", "#FF9933", "#66CC00", "#339900", "#336633", "#00CCFF"))))
ggsave("16SrRNA_BCC_Rplot.pdf", plot=last_plot(), device=NULL, path=NULL, scale=1, width=NA, height=NA, dpi=300, limitsize=TRUE)
#Import soil biology - PMN, POXC data
soilbio <- read.csv("../data/BDsoilbio.csv", row.names = 1)
soilbio <- read.csv("../data/BDsoilbio.csv", row.names = 1)
soil.bio.microbes <- cbind(soilbio,BDdataREL)
adonis = adonis(soil.bio.microbes[,-c(1:6)] ~ POXC +  PMC + PMN, method = "bray", data = soil.bio.microbes, perm=1000)
adonis
adonis = adonis(soil.bio.microbes[,-c(1:6)] ~ PMN + POXC +  PMC, method = "bray", data = nsoil.bio.microbes, perm=1000)
adonis = adonis(soil.bio.microbes[,-c(1:6)] ~ PMN + POXC +  PMC, method = "bray", data = soil.bio.microbes, perm=1000)
adonis = adonis(soil.bio.microbes[,-c(1:6)] ~ PMN + POXC +  PMC, method = "bray", data = soil.bio.microbes, perm=1000)
adonis
adonis = adonis(soil.bio.microbes[,-c(1:6)] ~ PMC + PMN + POXC, method = "bray", data = soil.bio.microbes, perm=1000)
adonis = adonis(soil.bio.microbes[,-c(1:6)] ~ PMC + PMN + POXC, method = "bray", data = soil.bio.microbes, perm=1000)
adonis
plant <- read.csv("../data/BDveg.csv", header=TRUE)
str(plant)
plant <- read.csv("../data/BDveg.csv", header=TRUE)
plant <- read.csv("../data/BDsoilbio.csv", row.names = 1)
plant.microbes <- cbind(plant,BDdataREL)
str(plant.microbes)
plant <- read.csv("../data/BDveg.csv", header=TRUE)
plant.microbes <- cbind(plant,BDdataREL)
plant.microbes <- cbind(BDveg,BDdataREL)
str(plant.microbes)
adonis = adonis(plant.microbes[,-c(1:13)] ~   crop_numb + covercrop_g + weeds_g + crop_g , method = "bray", data = new.data, perm=1000)
View(BDveg)
adonis = adonis(plant.microbes[,-c(1:13)] ~   crop_numb + covercrop_g + weeds_g + crop_g , method = "bray", data = plant.microbes, perm=1000)
adonis
adonis = adonis(plant.microbes[,-c(1:13)] ~  crop_g + crop_numb + covercrop_g + weeds_g, method = "bray", data = plant.microbes, perm=1000)
adonis
adonis = adonis(plant.microbes[,-c(1:13)] ~ weeds_g + crop_g + crop_numb + covercrop_g, method = "bray", data = plant.microbes, perm=1000)
adonis = adonis(plant.microbes[,-c(1:13)] ~ weeds_g + crop_g + crop_numb + covercrop_g, method = "bray", data = plant.microbes, perm=1000)
adonis
adonis = adonis(new.data[,-c(1:13)] ~ covercrop_g + weeds_g + crop_g + crop_numb, method = "bray", data = new.data, perm=1000)
adonis = adonis(plant.microbes[,-c(1:13)] ~ covercrop_g + weeds_g + crop_g + crop_numb, method = "bray", data = plant.microbes, perm=1000)
adonis = adonis(plant.microbes[,-c(1:13)] ~ covercrop_g + weeds_g + crop_g + crop_numb, method = "bray", data = plant.microbes, perm=1000)
adonis
data.phld <- read.csv("../data/PHLD_TRFLP.csv", header=TRUE)
str(data.phld)
adonis = adonis(data.phld[,-c(1:9)] ~ trt, method = "bray", data = data.phld, perm=1000)
adonis
adonis = adonis(data.phld[,-c(1:9)] ~ rotation, method = "bray", data = data.phld, perm=1000)
adonis
phld <- phld.in[-(which(rownames(design.in) %in% SnW)), ]
phld.in <- read.csv("../data/PHLD_TRFLP.csv", header=TRUE)
str(phld.in)
phld <- phld.in[-(which(rownames(design.in) %in% SnW)), ]
phld <- droplevels(design)
View(phld)
adonis = adonis(data.phld[,-c(1:9)] ~ trt, method = "bray", data = phld, perm=1000)
adonis
adonis = adonis(data.phld[,-c(1:9)] ~ rotation, method = "bray", data = phld, perm=1000)
adonis
View(phld.in)
phld.in <- read.csv("../data/PHLD_TRFLP.csv", header=TRUE)
str(phld.in)
phld <- phld.in[-(which(rownames(design.in) %in% SnW)), ]
phld <- droplevels(design)
str(phld)
adonis = adonis(phld[,-c(1:9)] ~ rotation, method = "bray", data = phld, perm=1000)
adonis
ggsave("../figures/16SrRNA_BCC_Rplot.pdf", plot=last_plot(), device=NULL, path=NULL, scale=1, width=NA, height=NA, dpi=300, limitsize=TRUE)
phld.in <- read.csv("../data/PHLD_TRFLP_NoSW.csv", header=TRUE)
str(phld.in)
phld <- read.csv("../data/PHLD_TRFLP_NoSW.csv", header=TRUE)
str(phld)
View(phld)
adonis = adonis(phld[,-c(1:9)] ~ rotation, method = "bray", data = phld, perm=1000)
adonis
sampleREL.dist <- vegdist(decostand((phld[,-c(1:9)]),method="log"),method="bray")
phld_pcoa <- cmdscale(sampleREL.dist,k=3,eig=TRUE,add=FALSE)
explainvar1 <- round(phld_pcoa$eig[1]/sum(phld_pcoa$eig)*100,2)
explainvar2 <- round(phld_pcoa$eig[2]/sum(phld_pcoa$eig)*100,2)
explainvar3 <- round(phld_pcoa$eig[3]/sum(phld_pcoa$eig)*100,2)
explainvar1 #PCoA 1 (59.7%)
explainvar2 #PCoA 2 (32.3%)
points <- cbind(as.data.frame(phld_pcoa$points), treatments)
L.centroids <- melt(points, id="treatments", measure.vars = c("V1", "V2"))
centroids <- cast(L.centroids, variable ~ treatments, mean)
centroids.se <- cast(L.centroids, variable ~ treatments, se)
centroids.sd <- cast(L.centroids, variable ~ treatments, sd)
cent.dataframe2 <- t(data.frame(rbind(centroids[1,-1], centroids[2,-1],
centroids.sd[1,-1],centroids.sd[2,-1])))
colnames(cent.dataframe2) <- c("V1", "V2", "V1e", "V2e")
cent.treats <- rownames(cent.dataframe2)
df <- as.data.frame(cent.dataframe2)
p2 <- ggplot(df, aes(x=V1, y=V2, colour=cent.treats)) + theme_bw()
p2 + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) + theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.001), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.001), colour="black") +
geom_point(size=6) +
scale_colour_manual(labels = c("mC", "C_1cov", "CS", "CSW", "CSW_1cov", "CSW_2cov", "fallow"),   values = c("#FFFFCC", "#FFFF00", "#FF9933", "#66CC00", "#339900", "#336633", "#00CCFF")) +
geom_point(shape=1, size = 6,colour = "black") +
theme(axis.title=element_text(size=18), axis.text=element_text(size=14), axis.text.x   = element_text(size=14), panel.border = element_rect(colour = "black",size=1.25)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
xlab("PCoA 1 (29.3%)") + ylab("PCoA 2 (14.0%)") +
labs(color = "Crop diversity") +
guides(colour = guide_legend(override.aes = list(pch=21, size = 6, colour="black",
fill=c("#FFFFCC", "#FFFF00", "#FF9933", "#66CC00", "#339900", "#336633", "#00CCFF"))))
phld <- read.csv("../data/PHLD_TRFLP_NoSW.csv", header=TRUE)
str(phld)
adonis = adonis(phld[,-c(1:9)] ~ rotation, method = "bray", data = phld, perm=1000)
adonis
sampleREL.dist <- vegdist(decostand((phld[,-c(1:9)]),method="log"),method="bray")
phld_pcoa <- cmdscale(sampleREL.dist,k=3,eig=TRUE,add=FALSE)
explainvar1 <- round(phld_pcoa$eig[1]/sum(phld_pcoa$eig)*100,2)
explainvar2 <- round(phld_pcoa$eig[2]/sum(phld_pcoa$eig)*100,2)
explainvar3 <- round(phld_pcoa$eig[3]/sum(phld_pcoa$eig)*100,2)
explainvar1 #PCoA 1 (22.4%)
explainvar2 #PCoA 2 (20.6%)
points <- cbind(as.data.frame(phld_pcoa$points), treatments)
L.centroids <- melt(points, id="treatments", measure.vars = c("V1", "V2"))
centroids <- cast(L.centroids, variable ~ treatments, mean)
centroids.se <- cast(L.centroids, variable ~ treatments, se)
centroids.sd <- cast(L.centroids, variable ~ treatments, sd)
cent.dataframe2 <- t(data.frame(rbind(centroids[1,-1], centroids[2,-1],
centroids.sd[1,-1],centroids.sd[2,-1])))
colnames(cent.dataframe2) <- c("V1", "V2", "V1e", "V2e")
cent.treats <- rownames(cent.dataframe2)
df <- as.data.frame(cent.dataframe2)
p2 <- ggplot(df, aes(x=V1, y=V2, colour=cent.treats)) + theme_bw()
p2 + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) + theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.001), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.001), colour="black") +
geom_point(size=6) +
scale_colour_manual(labels = c("mC", "C_1cov", "CS", "CSW", "CSW_1cov", "CSW_2cov", "fallow"),   values = c("#FFFFCC", "#FFFF00", "#FF9933", "#66CC00", "#339900", "#336633", "#00CCFF")) +
geom_point(shape=1, size = 6,colour = "black") +
theme(axis.title=element_text(size=18), axis.text=element_text(size=14), axis.text.x   = element_text(size=14), panel.border = element_rect(colour = "black",size=1.25)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
xlab("PCoA 1 (29.3%)") + ylab("PCoA 2 (14.0%)") +
labs(color = "Crop diversity") +
guides(colour = guide_legend(override.aes = list(pch=21, size = 6, colour="black",
fill=c("#FFFFCC", "#FFFF00", "#FF9933", "#66CC00", "#339900", "#336633", "#00CCFF"))))
ggsave("../figures/PHLD_Rplot.pdf", plot=last_plot(), device=NULL, path=NULL, scale=1, width=NA, height=NA, dpi=300, limitsize=TRUE)
rm(list=ls())
setwd("~/GitHub/CropDiversity/analyses")
se <- function(x, ...){sd(x, na.rm = TRUE)/sqrt(length(na.omit(x)))}
ci <- function(x, ...){1.96 * sd(x,na.rm = TRUE)}
source("../bin/DiversityFunctions.R")
source("../bin/MothurTools.R")
source("../bin/MothurTools.R")
require("vegan")
source("../bin/MothurTools.R")
require("vegan")
require("nlme")
require("reshape")
require("ggplot2")
require("ade4")
require("png")
require ("agricolae")
design.in <- read.csv("../data/BDsoil_exptdesign.csv", row.names = 1)
SnW <- rownames(design.in[which(design.in$rotation == "S" |
design.in$rotation == "W"), ])
design <- design.in[-(which(rownames(design.in) %in% SnW)), ]
design <- droplevels(design)
treatments <- design$rotation
levels(treatments) <- c("fallow", "CSW-2cov", "CSW-1cov", "CSW",
"CS", "C-1cov", "C")
BDdata.in2 <- BDdata.in[grepl("BD[0-9][0-9]", rownames(BDdata.in)), ]
BDdata.in <- read.otu("../data/BD.shared")
BDdata.in2 <- BDdata.in[grepl("BD[0-9][0-9]", rownames(BDdata.in)), ]
SnW2 <- gsub("-", "", SnW)
BDdata.in2 <- BDdata.in2[-(which(rownames(BDdata.in2) %in% SnW2)), ]
BDdata <- BDdata.in2[, which(colSums(BDdata.in2) >= 2)]
BDdataPA <- (BDdata > 0) * 1
BDdataREL <- BDdata
for(i in 1:dim(BDdata)[1]){
BDdataREL[i,] <- BDdata[i,]/sum(BDdata[i,])
}
phld.in <- read.csv("../data/T-RF Matrix_Original_AP.csv", row.names = 1)
SnW <- rownames(phld.in[which(phld.in$rotation == "S" |
phld.in$rotation == "W"), ])
phld <- phld.in[-(which(rownames(phld.in) %in% SnW)), ]
phld <- droplevels(phld)
str(phld)
treatments <- phld$rotation
levels(treatments) <- c("fallow", "CSW-2cov", "CSW-1cov", "CSW",
"CS", "C-1cov", "C")
phld.test <- data.frame(lapply(phld[,-c(1:7)], as.numeric))
str(phld.test)
phldREL <- phld.test
for(i in 1:dim(phld.test)[1]){
phldREL[i,] <- phld.test[i,]/sum(phld.test[i,], na.rm=T)
}
phld.new <-cbind(phld[,c(1:7)],phld.test)
str(phld.new)
phld.new <-cbind(phld[,c(1:7)],phld.REL)
phld.new <-cbind(phld[,c(1:7)],phldREL)
str(phld.new)
adonis = adonis(phld.new[,-c(1:7)] ~ rotation, method = "bray", data = phld, perm=1000)
adonis = adonis(phld.new[,-c(1:7)] ~ rotation, method = "bray", data = phld.new, perm=1000)
new.phld <-cbind(phld[,c(1:7)],phldREL)
str(new.phld)
adonis = adonis(new.phld[,-c(1:7)] ~ rotation+block, method = "bray", data = new.phld, perm=1000)
adonis = adonis(new.phld[,-c(1:7)] ~ rotation+block, method = "bray", data = new.phld, perm=1000, na.rm=T)
adonis
adonis = adonis(new.phld[,-c(1:7)] ~ rotation, method = "bray", data = new.phld, perm=1000, na.rm=T)
adonis
View(new.phld)
adonis = adonis(new.phld[,-c(1:7)] ~ rotation, method = "bray", data = new.phld, perm=1000, na.action = na.omit)
adonis = adonis(new.phld[,-c(1:7)] ~ rotation, method = "bray", data = new.phld, perm=1000, na = na.omit)
adonis = adonis(new.phld[,-c(1:7), na.action=na.exclude] ~ rotation+block, method = "bray", data = new.phld, perm=1000, na.rm=T)
adonis = adonis(new.phld[,-c(1:7)] ~ rotation+block, method = "bray", data = new.phld, perm=1000, na.action=na.exclude)
adonis = adonis(new.phld[,-c(1:7)] ~ rotation+block, method = "bray", data = new.phld, perm=1000, na=na.omit)
adonis = adonis(new.phld[,-c(1:7)] ~ rotation+block, method = "bray", data = new.phld, perm=1000, na.rm=na.omit)
library(tidyr)
install.packages("tidyr")
library(tidyr)
new.phld %>% drop_na()
str(new.phld)
new.phld2 <- new.phld %>% drop_na()
View(new.phld2)
str(new.phld2)
adonis = adonis(new.phld2[,-c(1:7)] ~ rotation+block, method = "bray", data = new.phld2, perm=1000)
adonis
new.phldREL <-cbind(phld[,c(1:7)],phldREL)
str(new.phldREL)
new.phldREL2 <- new.phldREL %>% drop_na()
str(new.phldREL2)
adonis = adonis(new.phldREL2[,-c(1:7)] ~ rotation+block, method = "bray", data = new.phldREL2, perm=1000)
adonis
sampleREL.dist <- vegdist(new.phldREL2[,-c(1:7)], method="bray")
phld_pcoa <- cmdscale(sampleREL.dist,k=3,eig=TRUE,add=FALSE)
explainvar1 <- round(phld_pcoa$eig[1]/sum(phld_pcoa$eig)*100,2)
explainvar2 <- round(phld_pcoa$eig[2]/sum(phld_pcoa$eig)*100,2)
explainvar3 <- round(phld_pcoa$eig[3]/sum(phld_pcoa$eig)*100,2)
explainvar1 #PCoA 1 (22.4%)
explainvar2 #PCoA 2 (20.6%)
explainvar3
sum.eig <- sum(explainvar1, explainvar2)
points <- cbind(as.data.frame(phld_pcoa$points), treatments)
treatments <- new.phldREL2$rotation
levels(treatments) <- c("fallow", "CSW-2cov", "CSW-1cov", "CSW",
"CS", "C-1cov", "C")
points <- cbind(as.data.frame(phld_pcoa$points), treatments)
L.centroids <- melt(points, id="treatments", measure.vars = c("V1", "V2"))
centroids <- cast(L.centroids, variable ~ treatments, mean)
centroids.se <- cast(L.centroids, variable ~ treatments, se)
centroids.sd <- cast(L.centroids, variable ~ treatments, sd)
cent.dataframe2 <- t(data.frame(rbind(centroids[1,-1], centroids[2,-1],
centroids.sd[1,-1],centroids.sd[2,-1])))
colnames(cent.dataframe2) <- c("V1", "V2", "V1e", "V2e")
cent.treats <- rownames(cent.dataframe2)
df <- as.data.frame(cent.dataframe2)
p2 <- ggplot(df, aes(x=V1, y=V2, colour=cent.treats)) + theme_bw()
p2 + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) + theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.001), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.001), colour="black") +
geom_point(size=6) +
scale_colour_manual(labels = c("mC", "C_1cov", "CS", "CSW", "CSW_1cov", "CSW_2cov", "fallow"),   values = c("#FFFFCC", "#FFFF00", "#FF9933", "#66CC00", "#339900", "#336633", "#00CCFF")) +
geom_point(shape=1, size = 6,colour = "black") +
theme(axis.title=element_text(size=18), axis.text=element_text(size=14), axis.text.x   = element_text(size=14), panel.border = element_rect(colour = "black",size=1.25)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
xlab("PCoA 1 (29.3%)") + ylab("PCoA 2 (14.0%)") +
labs(color = "Crop diversity") +
guides(colour = guide_legend(override.aes = list(pch=21, size = 6, colour="black",
fill=c("#FFFFCC", "#FFFF00", "#FF9933", "#66CC00", "#339900", "#336633", "#00CCFF"))))
ggsave("../figures/PHLD_Rplot.pdf", plot=last_plot(), device=NULL, path=NULL, scale=1, width=NA, height=NA, dpi=300, limitsize=TRUE)
sampleREL.dist <- vegdist(new.phldREL2[,-c(1:7)], method="bray")
phld_pcoa <- cmdscale(sampleREL.dist,k=3,eig=TRUE,add=FALSE)
points <- cbind(as.data.frame(BD_pcoa$points), treatments)
points <- cbind(as.data.frame(phld_pcoa$points), treatments)
L.centroids <- melt(points, id="treatments", measure.vars = c("V1", "V2"))
centroids <- cast(L.centroids, variable ~ treatments, mean)
centroids.se <- cast(L.centroids, variable ~ treatments, se)
centroids.sd <- cast(L.centroids, variable ~ treatments, sd)
cent.dataframe <- t(data.frame(rbind(centroids[1,-1], centroids[2,-1],
centroids.sd[1,-1],centroids.sd[2,-1])))
colnames(cent.dataframe) <- c("V1", "V2", "V1e", "V2e")
cent.treats <- rownames(cent.dataframe)
explainvar1 #Include in PCoA 1 axis label 29.3%
explainvar2 #Include in PCoA 2 axis label 14.0%
df <- as.data.frame(cent.dataframe)
p <- ggplot(df, aes(x=V1, y=V2, colour=cent.treats)) + theme_bw()
p + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(size=5) +
scale_colour_manual(labels = c("mC", "C_1cov", "CS", "CSW", "CSW_1cov", "CSW_2cov", "fallow"),   values = c("#FFFFCC", "#FFFF00", "#FF9933", "#66CC00", "#339900", "#336633", "#00CCFF")) +
geom_point(shape=1, size = 5,colour = "black") +
theme(axis.title=element_text(size=18), axis.text=element_text(size=14), axis.text.x   = element_text(size=14), panel.border = element_rect(colour = "black",size=1.25)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
xlab("PCoA 1 (29.3%)") + ylab("PCoA 2 (14.0%)") +
labs(color = "Crop diversity") +
guides(colour = guide_legend(override.aes = list(pch=21, size = 4, colour="black",
fill=c("#FFFFCC", "#FFFF00", "#FF9933", "#66CC00", "#339900", "#336633", "#00CCFF"))))
ggsave("../figures/PHLD_Rplot.pdf", plot=last_plot(), device=NULL, path=NULL, scale=1, width=NA, height=NA, dpi=300, limitsize=TRUE)
phld.test.2 <- phld.test[which(rowSums(phld.test[,c(1:7)]) >= 5000), ]
dim(phld.test.2)
dim(phld.test)
dim(phld.test.2)
phld.in <- read.csv("../data/T-RF Matrix_Original_AP.csv", row.names = 1)
SnW <- rownames(phld.in[which(phld.in$rotation == "S" |
phld.in$rotation == "W"), ])
phld <- phld.in[-(which(rownames(phld.in) %in% SnW)), ]
phld <- droplevels(phld)
str(phld)
SnW <- rownames(phld.in[which(phld.in$rotation == "S" |
phld.in$rotation == "W"), ])
phld <- phld.in[-(which(rownames(phld.in) %in% SnW)), ]
phld <- droplevels(phld)
str(phld)
phld.test <- data.frame(lapply(phld[,-c(1:7)], as.numeric))
str(phld.test)
phld.test.2 <- phld.test[which(rowSums(phld.test[,-c(1:7)]) >= 5000), ]
dim(phld.test)
dim(phld.test.2)
phld.in <- read.csv("../data/T-RF Matrix_Original_AP.csv", row.names = 1)
SnW <- rownames(phld.in[which(phld.in$rotation == "S" |
phld.in$rotation == "W"), ])
phld <- phld.in[-(which(rownames(phld.in) %in% SnW)), ]
phld <- droplevels(phld)
str(phld)
phld.test <- data.frame(lapply(phld[,-c(1:7)], as.numeric))
str(phld.test)
phldREL <- phld.test
for(i in 1:dim(phld.test)[1]){
phldREL[i,] <- phld.test[i,]/sum(phld.test[i,], na.rm=T)
}
new.phldREL <-cbind(phld[,c(1:7)],phldREL)
str(new.phldREL)
library(tidyr)
new.phldREL2 <- new.phldREL %>% drop_na()
str(new.phldREL2)
adonis = adonis(new.phldREL2[,-c(1:7)] ~ rotation+block, method = "bray", data = new.phldREL2, perm=1000)
adonis
treatments <- new.phldREL2$rotation
levels(treatments) <- c("fallow", "CSW-2cov", "CSW-1cov", "CSW",
"CS", "C-1cov", "C")
sampleREL.dist <- vegdist(new.phldREL2[,-c(1:7)], method="bray")
phld_pcoa <- cmdscale(sampleREL.dist,k=3,eig=TRUE,add=FALSE)
explainvar1 <- round(phld_pcoa$eig[1]/sum(phld_pcoa$eig)*100,2)
explainvar2 <- round(phld_pcoa$eig[2]/sum(phld_pcoa$eig)*100,2)
explainvar3 <- round(phld_pcoa$eig[3]/sum(phld_pcoa$eig)*100,2)
explainvar1 #PCoA 1 (22.4%)
explainvar2 #PCoA 2 (20.6%)
explainvar3
sum.eig <- sum(explainvar1, explainvar2)
points <- cbind(as.data.frame(phld_pcoa$points), treatments)
L.centroids <- melt(points, id="treatments", measure.vars = c("V1", "V2"))
centroids <- cast(L.centroids, variable ~ treatments, mean)
centroids.se <- cast(L.centroids, variable ~ treatments, se)
centroids.sd <- cast(L.centroids, variable ~ treatments, sd)
cent.dataframe <- t(data.frame(rbind(centroids[1,-1], centroids[2,-1],
centroids.sd[1,-1],centroids.sd[2,-1])))
colnames(cent.dataframe) <- c("V1", "V2", "V1e", "V2e")
cent.treats <- rownames(cent.dataframe)
explainvar1 #Include in PCoA 1 axis label 29.3%
explainvar2 #Include in PCoA 2 axis label 14.0%
df <- as.data.frame(cent.dataframe)
p <- ggplot(df, aes(x=V1, y=V2, colour=cent.treats)) + theme_bw()
p + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(size=5) +
scale_colour_manual(labels = c("mC", "C_1cov", "CS", "CSW", "CSW_1cov", "CSW_2cov", "fallow"),   values = c("#FFFFCC", "#FFFF00", "#FF9933", "#66CC00", "#339900", "#336633", "#00CCFF")) +
geom_point(shape=1, size = 5,colour = "black") +
theme(axis.title=element_text(size=18), axis.text=element_text(size=14), axis.text.x   = element_text(size=14), panel.border = element_rect(colour = "black",size=1.25)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
xlab("PCoA 1 (29.3%)") + ylab("PCoA 2 (14.0%)") +
labs(color = "Crop diversity") +
guides(colour = guide_legend(override.aes = list(pch=21, size = 4, colour="black",
fill=c("#FFFFCC", "#FFFF00", "#FF9933", "#66CC00", "#339900", "#336633", "#00CCFF"))))
ggsave("../figures/PHLD_Rplot.pdf", plot=last_plot(), device=NULL, path=NULL, scale=1, width=NA, height=NA, dpi=300, limitsize=TRUE)
rm(list=ls())
setwd("~/GitHub/CropDiversity/analyses")
se <- function(x, ...){sd(x, na.rm = TRUE)/sqrt(length(na.omit(x)))}
ci <- function(x, ...){1.96 * sd(x,na.rm = TRUE)}
source("../bin/DiversityFunctions.R")
source("../bin/MothurTools.R")
require("vegan")
require("nlme")
require("reshape")
require("ggplot2")
require("ade4")
require("png")
require ("agricolae")
design.in <- read.csv("../data/BDsoil_exptdesign.csv", row.names = 1)
SnW <- rownames(design.in[which(design.in$rotation == "S" |
design.in$rotation == "W"), ])
design <- design.in[-(which(rownames(design.in) %in% SnW)), ]
design <- droplevels(design)
treatments <- design$rotation
levels(treatments) <- c("fallow", "CSW-2cov", "CSW-1cov", "CSW",
"CS", "C-1cov", "C")
phld.in <- read.csv("../data/T-RF Matrix_Original_AP.csv", row.names = 1)
SnW <- rownames(phld.in[which(phld.in$rotation == "S" |
phld.in$rotation == "W"), ])
phld <- phld.in[-(which(rownames(phld.in) %in% SnW)), ]
phld <- droplevels(phld)
str(phld)
phld.test <- data.frame(lapply(phld[,-c(1:7)], as.numeric))
str(phld.test)
phldREL <- phld.test
for(i in 1:dim(phld.test)[1]){
phldREL[i,] <- phld.test[i,]/sum(phld.test[i,], na.rm=T)
}
new.phldREL <-cbind(phld[,c(1:7)],phldREL)
str(new.phldREL)
library(tidyr)
new.phldREL2 <- new.phldREL %>% drop_na()
str(new.phldREL2)
adonis = adonis(new.phldREL2[,-c(1:7)] ~ rotation+block, method = "bray", data = new.phldREL2, perm=1000)
adonis
treatments <- new.phldREL2$rotation
levels(treatments) <- c("fallow", "CSW-2cov", "CSW-1cov", "CSW",
"CS", "C-1cov", "C")
sampleREL.dist <- vegdist(new.phldREL2[,-c(1:7)], method="bray")
phld_pcoa <- cmdscale(sampleREL.dist,k=3,eig=TRUE,add=FALSE)
explainvar1 <- round(phld_pcoa$eig[1]/sum(phld_pcoa$eig)*100,2)
explainvar2 <- round(phld_pcoa$eig[2]/sum(phld_pcoa$eig)*100,2)
explainvar3 <- round(phld_pcoa$eig[3]/sum(phld_pcoa$eig)*100,2)
explainvar1 #PCoA 1 (22.4%)
explainvar2 #PCoA 2 (20.6%)
explainvar3
sum.eig <- sum(explainvar1, explainvar2)
points <- cbind(as.data.frame(phld_pcoa$points), treatments)
L.centroids <- melt(points, id="treatments", measure.vars = c("V1", "V2"))
centroids <- cast(L.centroids, variable ~ treatments, mean)
centroids.se <- cast(L.centroids, variable ~ treatments, se)
centroids.sd <- cast(L.centroids, variable ~ treatments, sd)
cent.dataframe <- t(data.frame(rbind(centroids[1,-1], centroids[2,-1],
centroids.sd[1,-1],centroids.sd[2,-1])))
colnames(cent.dataframe) <- c("V1", "V2", "V1e", "V2e")
cent.treats <- rownames(cent.dataframe)
explainvar1 #Include in PCoA 1 axis label 29.3%
explainvar2 #Include in PCoA 2 axis label 14.0%
df <- as.data.frame(cent.dataframe)
p <- ggplot(df, aes(x=V1, y=V2, colour=cent.treats)) + theme_bw()
p + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(size=5) +
scale_colour_manual(labels = c("mC", "C_1cov", "CS", "CSW", "CSW_1cov", "CSW_2cov", "fallow"),   values = c("#FFFFCC", "#FFFF00", "#FF9933", "#66CC00", "#339900", "#336633", "#00CCFF")) +
geom_point(shape=1, size = 5,colour = "black") +
theme(axis.title=element_text(size=18), axis.text=element_text(size=14), axis.text.x   = element_text(size=14), panel.border = element_rect(colour = "black",size=1.25)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
xlab("PCoA 1 (29.3%)") + ylab("PCoA 2 (14.0%)") +
labs(color = "Crop diversity") +
guides(colour = guide_legend(override.aes = list(pch=21, size = 4, colour="black",
fill=c("#FFFFCC", "#FFFF00", "#FF9933", "#66CC00", "#339900", "#336633", "#00CCFF"))))
ggsave("../figures/PHLD_Rplot.pdf", plot=last_plot(), device=NULL, path=NULL, scale=1, width=NA, height=NA, dpi=300, limitsize=TRUE)
df <- as.data.frame(cent.dataframe)
p <- ggplot(df, aes(x=V1, y=V2, colour=cent.treats)) + theme_bw()
p + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_point(size=5) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
scale_colour_manual(labels = c("mC", "C_1cov", "CS", "CSW", "CSW_1cov", "CSW_2cov", "fallow"),   values = c("#FFFFCC", "#FFFF00", "#FF9933", "#66CC00", "#339900", "#336633", "#00CCFF")) +
geom_point(shape=1, size = 5,colour = "black") +
theme(axis.title=element_text(size=18), axis.text=element_text(size=14), axis.text.x   = element_text(size=14), panel.border = element_rect(colour = "black",size=1.25)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
xlab("PCoA 1 (29.3%)") + ylab("PCoA 2 (14.0%)") +
labs(color = "Crop diversity") +
guides(colour = guide_legend(override.aes = list(pch=21, size = 4, colour="black",
fill=c("#FFFFCC", "#FFFF00", "#FF9933", "#66CC00", "#339900", "#336633", "#00CCFF"))))
ggsave("../figures/PHLD_Rplot.pdf", plot=last_plot(), device=NULL, path=NULL, scale=1, width=NA, height=NA, dpi=300, limitsize=TRUE)
head(new.phldREL2)
head(design)
